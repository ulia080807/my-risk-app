from typing import Dict, List
from src.api.models import RiskCategory, RiskData, ActionItem

class RecommendationGenerator:
    """–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π"""
    
    @staticmethod
    def get_risk_specific_recommendations(risk_category: RiskCategory, risk_data: RiskData) -> Dict:
        """–ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ä–∏—Å–∫–∞"""
        
        base_recommendations = {
            RiskCategory.LOW: {
                "general": "–í–∞—à —Ä–∏—Å–∫ –∏–Ω—Å—É–ª—å—Ç–∞ –≤ –±–ª–∏–∂–∞–π—à–∏–µ –ø–æ–ª–≥–æ–¥–∞ ‚Äî –Ω–∏–∑–∫–∏–π. –ù–æ –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞ –≤–∞–∂–Ω–∞ –≤ –ª—é–±–æ–º –≤–æ–∑—Ä–∞—Å—Ç–µ!",
                "actions": []
            },
            RiskCategory.MODERATE: {
                "general": "–í–∞—à —Ä–∏—Å–∫ ‚Äî –≤—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ. –í–∞—à–∏ –¥–µ–π—Å—Ç–≤–∏—è –≤ –±–ª–∏–∂–∞–π—à–∏–µ –Ω–µ–¥–µ–ª–∏ –º–æ–≥—É—Ç –µ–≥–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Å–Ω–∏–∑–∏—Ç—å.",
                "actions": []
            },
            RiskCategory.HIGH: {
                "general": "–í–∞—à —Ä–∏—Å–∫ –∏–Ω—Å—É–ª—å—Ç–∞ –≤ –±–ª–∏–∂–∞–π—à–∏–µ –º–µ—Å—è—Ü—ã ‚Äî –≤—ã—Å–æ–∫–∏–π. –¢—Ä–µ–±—É–µ—Ç—Å—è —Å—Ä–æ—á–Ω–∞—è –≤—Ä–∞—á–µ–±–Ω–∞—è –æ—Ü–µ–Ω–∫–∞.",
                "actions": []
            }
        }
        
        recommendations = base_recommendations[risk_category]
        
        # –î–æ–±–∞–≤–ª—è–µ–º –æ–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
        general_actions = []
        
        # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ê–î
        if risk_data.high_bp:
            general_actions.append({
                "priority": 1,
                "title": "–ö–æ–Ω—Ç—Ä–æ–ª—å –∞—Ä—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–≥–æ –¥–∞–≤–ª–µ–Ω–∏—è",
                "description": "–ò–∑–º–µ—Ä—è–π—Ç–µ –ê–î –µ–∂–µ–¥–Ω–µ–≤–Ω–æ —É—Ç—Ä–æ–º –∏ –≤–µ—á–µ—Ä–æ–º (–∑–∞–ø–∏—Å—ã–≤–∞–π—Ç–µ –≤ –¥–Ω–µ–≤–Ω–∏–∫). –ï—Å–ª–∏ –ê–î ‚â•140/90 ‚â•3 –¥–Ω—è –ø–æ–¥—Ä—è–¥ ‚Äî –∑–∞–ø–∏—à–∏—Ç–µ—Å—å –∫ —Ç–µ—Ä–∞–ø–µ–≤—Ç—É.",
                "frequency": "daily"
            })
        
        # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∫—É—Ä–µ–Ω–∏—é
        if risk_data.smoking == 'current':
            general_actions.append({
                "priority": 2,
                "title": "–û—Ç–∫–∞–∑ –æ—Ç –∫—É—Ä–µ–Ω–∏—è",
                "description": "–ù–∞—á–Ω–∏—Ç–µ –æ—Ç–∫–∞–∑ —Å–µ–π—á–∞—Å ‚Äî —Ä–∏—Å–∫ —Å–Ω–∏–∂–∞–µ—Ç—Å—è —É–∂–µ —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞ –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–∏–≥–∞—Ä–µ—Ç—ã.",
                "frequency": "immediate"
            })
        
        # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤–µ—Å—É
        bmi = risk_data.bmi
        if bmi > 27:
            general_actions.append({
                "priority": 3,
                "title": "–°–Ω–∏–∂–µ–Ω–∏–µ –≤–µ—Å–∞",
                "description": f"–°–Ω–∏–∂–µ–Ω–∏–µ –≤–µ—Å–∞ –Ω–∞ 5‚Äì10% ({round(risk_data.weight_kg * 0.05, 1)}‚Äì{round(risk_data.weight_kg * 0.1, 1)} –∫–≥) —Å–Ω–∏–∂–∞–µ—Ç —Ä–∏—Å–∫ –∏–Ω—Å—É–ª—å—Ç–∞ –Ω–∞ 25%.",
                "frequency": "weekly"
            })
        
        # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
        if risk_data.lifestyle in ['sedentary', 'inactive']:
            general_actions.append({
                "priority": 4,
                "title": "–§–∏–∑–∏—á–µ—Å–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å",
                "description": "–ù–∞—á–Ω–∏—Ç–µ —Å 30 –º–∏–Ω—É—Ç —Ö–æ–¥—å–±—ã 5 –¥–Ω–µ–π –≤ –Ω–µ–¥–µ–ª—é. –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–π—Ç–µ –Ω–∞–≥—Ä—É–∑–∫—É.",
                "frequency": "daily"
            })
        
        # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Ö–æ–ª–µ—Å—Ç–µ—Ä–∏–Ω—É
        if risk_data.ldl_cholesterol and risk_data.ldl_cholesterol > 3.0:
            general_actions.append({
                "priority": 5,
                "title": "–ö–æ–Ω—Ç—Ä–æ–ª—å —Ö–æ–ª–µ—Å—Ç–µ—Ä–∏–Ω–∞",
                "description": f"–í–∞—à –õ–ü–ù–ü ({risk_data.ldl_cholesterol} –º–º–æ–ª—å/–ª) –≤—ã—à–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–≥–æ —É—Ä–æ–≤–Ω—è (<3.0). –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –≤—Ä–∞—á—É.",
                "frequency": "monthly"
            })
        
        # –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É
        general_actions.sort(key=lambda x: x['priority'])
        
        # –î–æ–±–∞–≤–ª—è–µ–º —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –≤—ã—Å–æ–∫–æ–≥–æ —Ä–∏—Å–∫–∞
        emergency_advice = ""
        if risk_category == RiskCategory.HIGH:
            emergency_advice = (
                "‚ö†Ô∏è –ï—Å–ª–∏ –µ—Å—Ç—å —Å–∏–º–ø—Ç–æ–º—ã –¥–∞–∂–µ 1‚Äì2 –º–∏–Ω—É—Ç—ã (–æ–Ω–µ–º–µ–Ω–∏–µ, –Ω–∞—Ä—É—à–µ–Ω–∏–µ —Ä–µ—á–∏, –∑—Ä–µ–Ω–∏—è, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏): "
                "‚Üí –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∑–≤–æ–Ω–∏—Ç–µ 103 –∏–ª–∏ 112. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –¢–ò–ê ‚Äî –ø—Ä–µ–¥–≤–µ—Å—Ç–Ω–∏–∫ –∏–Ω—Å—É–ª—å—Ç–∞!"
            )
        
        recommendations['actions'] = general_actions
        recommendations['emergency_advice'] = emergency_advice
        
        return recommendations
    
    @staticmethod
    def get_educational_content() -> Dict:
        """–ü–æ–ª—É—á–∏—Ç—å –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç"""
        return {
            "typical_symptoms": [
                {
                    "code": "FAST_F",
                    "title": "–õ–∏—Ü–æ (Face)",
                    "description": "–ê—Å–∏–º–º–µ—Ç—Ä–∏—è –ª–∏—Ü–∞, –æ–ø—É—â–µ–Ω–∏–µ —É–≥–æ–ª–∫–∞ —Ä—Ç–∞, –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–ª—ã–±–Ω—É—Ç—å—Å—è —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ",
                    "icon": "üòê",
                    "emergency_level": "high"
                },
                {
                    "code": "FAST_A",
                    "title": "–†—É–∫–∏ (Arms)",
                    "description": "–°–ª–∞–±–æ—Å—Ç—å –∏–ª–∏ –æ–Ω–µ–º–µ–Ω–∏–µ –≤ –æ–¥–Ω–æ–π —Ä—É–∫–µ, –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–Ω—è—Ç—å –æ–±–µ —Ä—É–∫–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ",
                    "icon": "üí™",
                    "emergency_level": "high"
                },
                {
                    "code": "FAST_S",
                    "title": "–†–µ—á—å (Speech)",
                    "description": "–ù–∞—Ä—É—à–µ–Ω–∏–µ —Ä–µ—á–∏, –Ω–µ–≤–Ω—è—Ç–Ω–∞—è –∏–ª–∏ —Å–ø—É—Ç–∞–Ω–Ω–∞—è —Ä–µ—á—å, –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ—Å—Ç—É—é —Ñ—Ä–∞–∑—É",
                    "icon": "üó£Ô∏è",
                    "emergency_level": "high"
                },
                {
                    "code": "FAST_T",
                    "title": "–í—Ä–µ–º—è (Time)",
                    "description": "–ö–∞–∂–¥–∞—è –º–∏–Ω—É—Ç–∞ –∫—Ä–∏—Ç–∏—á–Ω–∞. –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∑–≤–æ–Ω–∏—Ç–µ 103 –∏–ª–∏ 112",
                    "icon": "‚è∞",
                    "emergency_level": "critical"
                },
                {
                    "code": "EXTRA_1",
                    "title": "–í–Ω–µ–∑–∞–ø–Ω–∞—è —Å–ª–µ–ø–æ—Ç–∞",
                    "description": "–ü–æ—Ç–µ—Ä—è –∑—Ä–µ–Ω–∏—è –Ω–∞ –æ–¥–∏–Ω –≥–ª–∞–∑ –∏–ª–∏ —á–∞—Å—Ç—å –ø–æ–ª—è –∑—Ä–µ–Ω–∏—è",
                    "icon": "üëÅÔ∏è",
                    "emergency_level": "high"
                },
                {
                    "code": "EXTRA_2",
                    "title": "–ì–æ–ª–æ–≤–æ–∫—Ä—É–∂–µ–Ω–∏–µ + –¥–∏—Å–∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è",
                    "description": "–í–Ω–µ–∑–∞–ø–Ω–æ–µ —Å–∏–ª—å–Ω–æ–µ –≥–æ–ª–æ–≤–æ–∫—Ä—É–∂–µ–Ω–∏–µ —Å –ø–æ—Ç–µ—Ä–µ–π —Ä–∞–≤–Ω–æ–≤–µ—Å–∏—è",
                    "icon": "üåÄ",
                    "emergency_level": "high"
                },
                {
                    "code": "EXTRA_3",
                    "title": "–ú–æ–ª–Ω–∏–µ–Ω–æ—Å–Ω–∞—è –≥–æ–ª–æ–≤–Ω–∞—è –±–æ–ª—å",
                    "description": "–°–∞–º–∞—è —Å–∏–ª—å–Ω–∞—è –≥–æ–ª–æ–≤–Ω–∞—è –±–æ–ª—å –≤ –∂–∏–∑–Ω–∏, –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –≤–Ω–µ–∑–∞–ø–Ω–æ",
                    "icon": "üí•",
                    "emergency_level": "high"
                }
            ],
            "atypical_symptoms": [
                {
                    "code": "ATYP_1",
                    "title": "–ò–∫–æ—Ç–∞ + —Ç–æ—à–Ω–æ—Ç–∞",
                    "description": "–£–ø–æ—Ä–Ω–∞—è –∏–∫–æ—Ç–∞ —Å —Ç–æ—à–Ω–æ—Ç–æ–π, –æ—Å–æ–±–µ–Ω–Ω–æ —É –∂–µ–Ω—â–∏–Ω",
                    "icon": "ü§¢",
                    "emergency_level": "medium"
                },
                {
                    "code": "ATYP_2",
                    "title": "–ë–æ–ª—å –≤ –≥—Ä—É–¥–∏/—Å–ø–∏–Ω–µ + —Å–ø—É—Ç–∞–Ω–Ω–æ—Å—Ç—å",
                    "description": "–ù–µ–æ–±—ã—á–Ω–∞—è –±–æ–ª—å —Å –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã–º–∏ –Ω–∞—Ä—É—à–µ–Ω–∏—è–º–∏",
                    "icon": "‚ù§Ô∏è‚Äçü©π",
                    "emergency_level": "medium"
                },
                {
                    "code": "ATYP_3",
                    "title": "–í–Ω–µ–∑–∞–ø–Ω–∞—è –∞–≥—Ä–µ—Å—Å–∏—è/–∞–ø–∞—Ç–∏—è",
                    "description": "–†–µ–∑–∫–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–≤–µ–¥–µ–Ω–∏—è –±–µ–∑ –≤–∏–¥–∏–º–æ–π –ø—Ä–∏—á–∏–Ω—ã",
                    "icon": "üò†",
                    "emergency_level": "medium"
                },
                {
                    "code": "ATYP_4",
                    "title": "–ü–æ—Ç–µ—Ä—è —Å–æ–∑–Ω–∞–Ω–∏—è",
                    "description": "–í–Ω–µ–∑–∞–ø–Ω–∞—è –ø–æ—Ç–µ—Ä—è —Å–æ–∑–Ω–∞–Ω–∏—è –±–µ–∑ —Å—É–¥–æ—Ä–æ–≥",
                    "icon": "üòµ",
                    "emergency_level": "high"
                },
                {
                    "code": "ATYP_5",
                    "title": "–û–±—â–∞—è —Å–ª–∞–±–æ—Å—Ç—å",
                    "description": "–í–Ω–µ–∑–∞–ø–Ω–∞—è —Å–∏–ª—å–Ω–∞—è —Å–ª–∞–±–æ—Å—Ç—å –≤–æ –≤—Å—ë–º —Ç–µ–ª–µ",
                    "icon": "üò´",
                    "emergency_level": "medium"
                }
            ],
            "emergency_contacts": [
                {
                    "name": "–°–∫–æ—Ä–∞—è –ø–æ–º–æ—â—å",
                    "number": "103",
                    "description": "–ï–¥–∏–Ω—ã–π –Ω–æ–º–µ—Ä —Å–∫–æ—Ä–æ–π –ø–æ–º–æ—â–∏ –ø–æ –†–æ—Å—Å–∏–∏"
                },
                {
                    "name": "–≠–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è —Å–ª—É–∂–±–∞",
                    "number": "112",
                    "description": "–ï–¥–∏–Ω—ã–π –Ω–æ–º–µ—Ä –≤—Å–µ—Ö —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã—Ö —Å–ª—É–∂–±"
                }
            ]
        }

# –°–∏–Ω–≥–ª—Ç–æ–Ω –∏–Ω—Å—Ç–∞–Ω—Å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞
recommendation_generator = RecommendationGenerator()
